<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
 
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>抽个奖</title>

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>


  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
  <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileColor" content="#0e90d2">

  <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
  <!--
  <link rel="canonical" href="http://www.example.com/">
  -->

  <link rel="stylesheet" href="assets/css/amazeui.css">
  <link rel="stylesheet" href="assets/css/app.css">
  <style>
    .center{
      position:relative;
      text-align:center;											 
      color:#000;
    }
    .nu-display{
      overflow:hidden;
      height:240px;
      font-size:30px;
    }
    .roll-mark{
      position:absolute;
      width:100%;
      height:240px;
      top:59px;
    }
    .roll-mark li{
      height:48px;
    }
    li.li-2{
      opacity:0.6;
    }
    li.li-1{
      opacity:0.4;
    }
    li.li-0{
      opacity:0.1;
      background:red;
    }
    .award-head{
      font-size:30px
    }
    .t{
      background:red;
    }
    .hi{
      font-size: 25px;
      color: red;
    }
  </style>
</head>
<body>
<!--[if lte IE 9]>
<p class="browsehappy">你正在使用<strong>过时</strong>的浏览器，Amaze UI 暂不支持。 请 <a
  href="http://browsehappy.com/" target="_blank">升级浏览器</a>
  以获得更好的体验！</p>
<![endif]-->
<!-- 页面内容 开发时删除 -->
<div class="am-g am-g-fixed am-margin-top">
  <div class='am-u-md-5'>
    <div>
      <p><input type="text" class="am-form-field am-round min" placeholder="起始数(包括在内)"/></p>
      <p><input type="text" class="am-form-field am-round max" placeholder="最大数(包括在内)"/></p>
    </div>
    <div class="am-slider am-slider-default award" >
      <p>奖品:</p>
      <ul class="am-slides">
        <li><img src="assets/img/yf.jpg" alt="衣服"/></li>
        <li><img src="assets/img/ke.jpg" alt="裤儿"/></li>
        <li><img src="assets/img/mxp.jpg" alt="明信片"/></li>
      </ul>
    </div> 
  </div>
  <div class="am-u-md-7">
    <div class="center">
      <h1>来抽奖</h1>
      <div class='roll-wrap' >
	<ul class='am-list nu-display'>
	  <li>0</li>
	  <li>0</li>
	  <li>0</li>
	  <li>0</li>
	  <li>0</li>
	  <li>0</li>
	  <li>0</li>
	</ul>
      </div>
      <div class="roll-mark ">
	<ul class='am-list'>
	  <li class="li-2"></li>
	  <li class="li-1"></li>
	  <li class="li-0"></li>
	  <li class="li-1"></li>
	  <li class="li-2"></li>
	</ul>
      </div>
      <button type="button" data-am-button class="roll_start am-btn am-btn-danger">开始抽奖</button>
    </div>
  </div>
</div>
<div class="am-g am-g-fixed am-margin-top">
  <p></p>
  <p class="am-u-sm-12">下载面是获奖名单。</p>
</div>
<div class="am-container">
  <ul class="am-list award-list">
  </ul>
</div>
<div class="am-modal am-modal-no-btn" tabindex="-1" id="award-alert">
</div>
<footer class="am-margin-top">
  <hr/>
  <p class="am-text-center">
    <small>by The Kaipoint Team.</small>
  </p>
</footer>
<script id="t-list" type="text/x-handlebars-template">
    <li class='am-g'>
      <div class="am-u-md-4">
	<a href="javascript:;">
	  <img src="{{src}}" class='am-img-responsive' alt="{{award}}">
	</a>
      </div>
      <div class="am-u-md-8">
	  <h3 class="award-head">
	    幸运号: {{nu}}号, 中奖: {{award}}
	  </h3>
      </div>
 
    </li>
</script>
<script id='t-alert' type="text/x-handlebars-template">
  <div class="am-modal-dialog">
    <div class="am-modal-hd">中奖通知!
     
    </div>
    <div class="am-modal-bd">
      Hi <span class='hi'> {{nu}}</span>号骚年, 你中奖了,奖品是<span class='hi'>{{award}}</span>
    </div>
  </div>
</script>

<!--[if lt IE 9]>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="assets/js/polyfill/rem.min.js"></script>
<script src="assets/js/polyfill/respond.min.js"></script>
<script src="assets/js/amazeui.legacy.js"></script>
<![endif]-->

<!--[if (gte IE 9)|!(IE)]><!-->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/amazeui.js"></script>
<script src="assets/js/handlebars.min.js"></script>
<script>
  $(function(){
    var $b = $('.roll_start');
    var luckdog=[//去重复得奖的,还可以用来做本地储存
    ];
    var hand = Handlebars;
    function sleep(t){
      var d = new Date();
      while((new Date()).getTime()<d.getTime()+t){
        
      }
    }
    function done(award,src){
      var luckyNum = $('ul.nu-display li:eq(2)').text();
      var aobj = {nu:luckyNum,award:award,src:src};
      var $modal = $('#award-alert');
      luckdog.push(aobj);
      var tp = hand.compile($('#t-list').html());
      var tp2 = hand.compile($('#t-alert').html());
      $modal.html(tp2(aobj));
      $('.award-list').append(tp(aobj));
      $modal.modal();
      console.log(luckdog);
    }
    function getRan(min,max){      
      var ran = Math.ceil(Math.random()*(max-min+1))+parseInt(min)-1;
      var f = false;
      for(var i in luckdog){
	if(luckdog[i]['nu']==ran){
	  f=true;
	  break;
	}
      }
      if(f){
	return getRan(min,max);
      }else{
	return ran;
      }
    }
    //alert(getRan(1,3));
    function roll(min,max,award,src){
      $b.hasClass("am-active") ? $b.removeClass('start') : $b.addClass('start');
      var stop = true;
      var timeout = 500;
      //while(!status && stop){//这种是同步的写法,根本没法玩
      //  timeout <1000 ? timeout+=50 : (stop=false);
      //  setTimeout(function(){
      //    console.log('1');	
      //  },timeout);
      //}
      function st(callback){
	var ran = getRan(min,max);
	if($b.hasClass('start')){
	   timeout >80 && (timeout-=90);

	   $('ul.nu-display').prepend('<li>'+ran+'</li>');
       	   setTimeout(function(){
       	     st(callback);
       	   },timeout);

        }
      }
      function sp(ca){
	var ran = getRan(min,max);
	if(!$b.hasClass('start')){
	  //停止
	  timeout ==500 && (timeout=20);
	  
	  if(timeout > 1000){
	    ca(award,src)
	    return;
	  }else{
	    timeout+=73;
	  }
	  $('ul.nu-display').prepend('<li>'+ran+'</li>');
       	  setTimeout(function(){
       	    sp(ca);
       	  },timeout);
	}
      }
      st();
      sp(done);
    }
    $b.on('click',function(){
      var  min = $('.min').val();
      var  max = $('.max').val();
      if(!min || !max){
	alert('Hi!  骚年,在左边设置好起始值和最大值!!');
	return;
      }
      
      var award = $('.award .am-active-slide img').attr('alt');
      var src = $('.award .am-active-slide img').attr('src');
      setButtonStatus();
      roll(min,max,award,src); 
    })
    function setButtonStatus() {
       var status = $b.hasClass('am-active') ?  '开始抽奖': '停..';
       $b.text(status);
    }
    $('.award').flexslider({
      direction: "vertical",        // String: 滚动方向 ["horizontal"|"vertical"]
      slideshow: false,
      controlNav: false 
    });
  })
</script>
<!--<![endif]-->

</body>
</html>
